---
title: "Eleven years of student replication projects provide evidence on the correlates of replicability in psychology"
author:
  - name: Veronica Boyce
    affiliation: Stanford
    footnote:
      - corresp
  - name: Maya Mathur
    affiliation: Stanford
  - name: Michael C. Frank
    affiliation: Stanford
address:
  - code: Stanford
    address: Stanford University
footnote:
  - code: corresp
    text: "Corresponding author. Email: vboyce@stanford.edu"
bibliography: ["251MA.bib"] # Replace with one or more of your own bibtex files. Better BibTeX for Zotero is your friend
csl: dmk-format.csl # Use any CSL style. See https://www.zotero.org/styles for a good list. Ignored if citation_package: natbib
link-citations: TRUE
output:
  bookdown::pdf_document2:
    toc: FALSE
    keep_tex: TRUE
    template: generic_article_template.tex
    #md_extensions: "-autolink_bare_uris"
    number_sections: TRUE
    citation_package: default # Can also be "natbib"
lang: en # Main document language in BCP47 format
geometry: "margin=25mm"
papersize: a4
#linestretch: 2 # for double spacing
endfloat: FALSE # Set to TRUE to turn on latex endfloat package to place figures and tables at end of document
# endfloatoption: # See endfloat documentation for more possibilities
#   - tablesfirst # Default
#   - nomarkers # Default
numberlines: FALSE
authblk: TRUE # FALSE = author affiliations in footnotes; TRUE = author affiliations in a block below author names
footnotehyper: FALSE # TRUE will give you enhanced table footnote capabilities. Set to FALSE to be able to use French blocks. Needed due to what appears to be a latex bug.
urlcolor: blue
linkcolor: blue
citecolor: blue
graphics: TRUE # Needed to be able to include images
tables: TRUE # Needed to be able to include tables
# fancyhdr:
#   first:
#     #headleft: "REPORT-NO-XXXX"
#     headright: "Kaplan et al. (2021)"
#     headrulewidth: 0pt
#     #footleft: A left foot
#     footrulewidth: 0pt
#   subsequent:
#     #headleft: "NEXT-PAGE-HEADER-LEFT"
#     headright: "Kaplan et al. (2021)"
#     headrulewidth: 1pt
#     footrulewidth: 0pt

header-includes:
 - \usepackage{tikz}
 - \usetikzlibrary{positioning,chains}
 - \usepackage{setspace}\singlespacing
 - \renewcommand{\textfraction}{0.00}
 - \renewcommand{\topfraction}{1}
 - \renewcommand{\bottomfraction}{1}
 - \renewcommand{\floatpagefraction}{1}
 - \setcounter{topnumber}{3}
 - \setcounter{bottomnumber}{3}
 - \setcounter{totalnumber}{4}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE) # By default, hide code; set to TRUE to see code
#knitr::opts_chunk$set(fig.pos = 'th') # Places figures at top or here
knitr::opts_chunk$set(out.width = '100%', dpi=300,
                      fig.width=8, fig.width=8) # Figure resolution and size
knitr::opts_chunk$set(fig.env="figure") # Latex figure environment

options(knitr.table.format="latex") # For kable tables to work without setting format option

knitr::opts_chunk$set(echo=F, warning=F, message=F)#dev = "png", dev.args = list(type = "cairo-png")
 library("papaja")
library("bookdown")
library("rticles")
 library(here)
 library(tidyverse)
 library(brms)
library(tidybayes)
library(kableExtra)
library(viridis)
library(cowplot)
library(ggthemes)
#r_refs("r-references.bib", append=F)
theme_set(theme_bw())
options(knitr.table.format = "pdf")

model_location="code/models"

d <- read_csv(here("data", "processed_data.csv")) |> filter(status!="unusable") |> filter(include!="no")
```

<!---------------------- Abstract --------------------->

::: {.abstract data-latex="" lang=en}



Cumulative scientific progress requires empirical results that are robust enough to support theory construction and extension. Yet in psychology, some prominent findings have failed to replicate, and large-scale studies suggest replicability issues are widespread. The identification of predictors of replication success is limited by the difficulty of conducting large samples of independent replication experiments, however: most investigations re-analyse the same set of ~170 replications. We introduce a new dataset of 176 replications from students in a graduate-level methods course. Replication results were judged to be successful in 49% of replications; of the 136 where effect sizes could be numerically compared, 46% had point estimates within the prediction interval of the original outcome (versus the expected 95%). Larger original effect sizes and within-participants designs were especially related to replication success. Our results indicate that, consistent with prior reports, the robustness of the psychology literature is low enough to limit cumulative progress by student investigators.
:::

# Introduction

Cumulative scientific progress requires empirical results that are robust enough to support both future empirical extensions and the construction of synthetic theories. Yet in psychology, some prominent individual findings have failed to replicate in multi-site replication attempts [ex. terror management theory, @klein2022; ego-depletion, @hagger2016]. One early large-scale replication project pegged the replication rate for findings in top-tier psychology journals at around 40% [RP:P; @openscienceconsortium2015]. Low replicability has negative consequences for the field as a whole: when scientists attempt to build on published results, they stand a good chance of meeting with failure. 

<!-- et interpreting the results of replication studies is difficult:  As each failed extension does not directly contradict the original result, many scientists may waste considerable time and resources pursuing results where there may be none.  -->
 
Addressing this issue requires a better understanding of the scope of the problem as well as the methodological and structural issues that might lead to replication failure [e.g., @smaldino2016;@simmons2011]. Estimating replicability in the literature is a key starting point, but, as we review below, there is limited consensus on what quantity exactly should be estimated.

Our viewpoint here is that one important estimand is the probability that a graduate student can identify a finding in the literature and replicate it successfully enough that they can build on that finding in subsequent work. Taking this perspective, our contribution is a new dataset of 176 replications of experimental studies from the social sciences, primarily psychology. These replications were conducted as individual course projects by students in a graduate-level experimental methods class between 2011 and 2022. We use this dataset to investigate the rate of replicability for such projects as well as the correlates of replication success. 
 
## What are we estimating when we measure replicability?

A few large-scale investigations have measured replication rates in samples of psychology studies. The first of these, RP:P, sampled roughly 100 studies from articles published in three top psychology journals in 2008 and distributed the studies across participating labs, finding an overall replication rate of around 40% [@openscienceconsortium2015]. The followup Many Labs studies investigated heterogeneity using short target studies that each compared two conditions. These study designs were not representative of the psychology literature as a whole, and due to the goal of measuring heterogeneity, they had large overall samples across multiple sites. Across Many Labs 1--3, only 29 of 51 target effects (57%) replicated [@klein2014; @klein2018; @ebersole2016]. @camerer2018 included all 21 behavioral social science studies from Nature and Science from 2010-2015 that were feasible to replicate. They consulted original authors and had high power to detect even small effects; under these conditions and with this sample, the replication rate was around 60%. 

While their sampling procedure and methods varied, these previous approaches to replicability have all focused on interpreting their results in terms of a potentially problematic estimand: the probability of a finding in the literature being truly replicable. Critics have pointed out that "true" replicability may not be possible to estimate outside of a specific sample [@vanbavel2016] or even time period [@ramscar2015]. 

Further, the methods used in these studies are not sufficient to yield an unbiased estimate of this quantity. In no case were studies randomly sampled from the literature; instead replication projects sampled from specific journals and adjusted the sample for feasibility concerns. These reasonable decisions further undermine the interpretation of the results from these studies as representing the proportion of true findings in the psychology literature as a whole. 
<!-- Sampling at random from the literature may not even be desirable, as arguably a literature will succeed if useful discoveries come out of it, not if random findings are true [@wilson2020].  -->

Rather than aim for some measure of true replicability, perhaps we should contextualize the true estimand for replication efforts based on their methodologies and outcome measures. Through this lens, RP:P estimated the rate at which findings from relatively simple experiments published in a few well-known journals at a particular time could be replicated in a typical psychology lab. Many Labs estimated the rate at which well-known, two-condition findings replicate in very large samples. @camerer2018 estimated which prestigious journal findings replicate when conducted in a highly-resourced environment with expert involvement. All of these could be potentially desirable estimands. 

But in practice, most scientific work is conducted by graduate students with limited time, limited budgets, and limited access to experts. If students cannot replicate a finding under these circumstances, they cannot build on it in their own empirical or theoretical work. How replicable are findings in the literature for graduate students operating under these less-than-ideal conditions? We address this question here.

Our current sample of replications is selected based on what experiments students were interested in and wanted to replicate, with some filtering for feasibility. This sampling is not at all random. It reflects how scientists generally choose which experiments to build on: those that are interesting and relatively feasible given methodological and budgetary constraints. 

In the current study, we estimate the probability of successful replication in this sample, with the goal of also identifying markers of when findings can (and cannot) support cumulative science. Our hope is to extend previous work that has attempted to find key correlates of replication success.

<!-- Our primary estimand is whether a student researcher, on selecting a finding of interest from the literature, can successfully achieve a result close enough to the original that they could build on it in their own work. In addition to this subjective measure of replicability, we also compare the effect sizes of the original and replication on one key outcome per study using prediction interval and p-original [@mathur2020].  -->

## When do replications succeed? 

Despite variation in the methods and outcomes used by large-scale replication studies, they are often aggregated together in analyses looking at the predictability of replication success. Prediction markets and elicitations have established that people can predict above chance what studies will replicate [@hoogeveen2019;@dreber2015; @forsell2019;@camerer2018], but have not identified concrete predictors that differentiate replications from non-replications. Machine learning approaches trained on the available replications are also above chance at predicting replication success [@yang2020; @youyou2023], though again the precise features relating to success are unclear. 

In search of such features, RP:P examined correlates of replicability in the RP:P sample and found that studies in cognitive psychology (as opposed to social psychology) and studies with larger effect sizes and smaller $p$ values were more likely to replicate. Using these same data combined with a few other smaller samples, @altmejd2019 examined statistical and demographic features of replication studies and identified larger sample sizes, larger effect sizes, and simple effects (as opposed to interaction terms) as predictive of replication.^[While most approaches to correlates of replicability have been correlational, experimental approaches can be used to test potential interventions [@protzko2020;@ebersole2020]. Experiments can be very valuable as tests of specific causes of non-replication, but they are expensive and time-consuming to conduct, and not all factors affecting replication success can be manipulated experimentally.]
<!-- showed, across 16 studies, that better methodological practices led to replication rates that matched theoretical expectations based on sampling error, with replication effect sizes comparable with the original. Many Labs 5 added expert (original author) advice to a replication process, and found that it did not substantially increase the replication rate for the 10 studies -->

These approaches are fundamentally limited by the available data. Large-scale replications are arduous and expensive to run, so only a few large-scale replication datasets exist, and most analyses draw heavily on same small set of data points. In particular, the RP:P dataset is much discussed and reanalyzed [@etz2016;@gilbert2016;@patil2016;@anderson2016] -- to the point that much of what we think we know about replicability may be over-fit to the 100 studies included in RP:P. 

Further, none of these studies focused on features of experimental design, such as within-participants designs or the use of repeated measures. There has been speculation that both of these factors should be linked to increased replicability due to their role in enabling increased statistical precision. Within-participants designs lead to more precise experimental estimates by allowing the estimation of correlated person-level variation across conditions; repeated measures allow for more precise estimation by averaging out measurement error. Both are often recommended by methodologists as part of good measurement practices, at least when they are feasible  [@rosenthal2008;@greenwald1976; @frank2023].

In sum, our current study examines the overall rate of replicability as well as the statistical and design features that predict replicability in a new sample of student replications. 

<!-- This study thus provides an estimate of the probability of cumulative progress by a capable student when faced with the current literature and offers some descrptive insight into which  -->

# Results


```{=latex}
\definecolor{bad}{HTML}{FFCCCB}
		\definecolor{meh}{HTML}{efefef}
			\definecolor{good}{HTML}{abcdff}
	\tikzset{
		mynode/.style={
			draw, rectangle, align=center, text width=4.5cm, scale=1, font=\small, inner sep=.5ex},
		arrow/.style={
		 very thick,->,>=stealth}
	}
	
\begin{figure}[ht]
	
	\begin{tikzpicture}[
		node distance=.8cm,
		start chain=1 going below,
		every join/.style=arrow,
		]
		\coordinate[on chain=1] (tc);
		\node[mynode, on chain=1, fill=meh] (n2)
		{\textbf{210} projects from 2011-2022};
		\node[mynode, join, on chain=1, fill=meh] (n3)
		{\textbf{189} original - replication pairs};
		\node[mynode, join, on chain=1, fill=meh] (n4)
		{\textbf{177} experimental pairs};
		\node[mynode, join, on chain=1, fill=good] (n5)
		{\textbf{176} pairs included};
		\node[mynode, join, on chain=1, fill=good] (n6)
		{\textbf{136} pairs with \\ calculable prediction interval};
		\node[mynode, join, on chain=1, fill=good] (n7)
		{\textbf{112} pairs with \\ standardized effect size};
		
		
		\begin{scope}[start chain=going right]
			\chainin (n2);
			\node[mynode, join, on chain, fill=bad]
			{ \textbf{2} missing projects \\ \textbf{19} reproducibility projects};
			\chainin (n3);
			\node[mynode, join, on chain, fill=bad]
			{\textbf{12} non-experimental pairs};
			\chainin (n4);
			\node[mynode, join, on chain, fill=bad]
			{\textbf{1} pair missing original sample size};
		\end{scope}
	\end{tikzpicture}
\caption{Of the 210 projects conducted for the class, 176 are included in our analysis, after excluding reproducibilty projects (with no new data collection), non-experimental replications, and missing projects. Of the 176, 136 report sufficient information to calculate prediction intervals, and 112 reported enough to calculated standardized effect sizes. }\label{fig:prisma}
\end{figure}

```



```{r, include=F}
matching <- d |> filter(include!="unusable") |> mutate(match=ifelse(replicated_instructor_code==replicated_report_code,1,0)) |> group_by(match) |> tally()

d |> filter(include!="unusable")
irr <- cor.test(d$replicated_instructor_code, d$replicated_report_code, method="spearman")$estimate
pred_int_avail <- d |> filter(include %in% c("stats", "pred_int")) |> tally()

target_dist <- quantile(d$target_N)
rep_dist <- quantile(d$replication_N)
ratio_dist <- d |> mutate(ratio_N=replication_N/target_N) |> pull(ratio_N) |> quantile()

```

PSYCH 251 is a graduate-level experimental methods class in experimental psychology taught at Stanford University. During the 10 week class, each student replicates a published finding. They individually re-implement the study, write analysis code, pre-register their study, collect data (typically using an online crowd-sourcing platform), and write a structured replication report. Students in the course are free to choose studies related to their research interests, with the default recommendation being an article from a recent year of Psychological Science. 
<!-- The resultant sample of studies is not a random sample from the literature but is representative of studies that are of interest to and doable by first year graduate students.  -->

The sample of replicated studies reflects the variability of the literature, including studies from different subfields (and occasionally fields outside of psychology), with different experimental methods and statistical outcomes. We leveraged naturally occurring variability in this sample of replications to examine how different demographic, experimental design, and statistical properties predict replication success. 

These replications were all conducted on short time scales, within a constrained class budget. In some cases the budget limited the number of participants who could be recruited, occasionally below what the original study included or what power analyses suggested. The replications had a median post-exclusion sample size that was `r round(ratio_dist[3]*100)`% of the original sample size (interquartile range `r round(ratio_dist[2]*100)`%-`r round(ratio_dist[4]*100)`%)^[Replications had a median of `r round(rep_dist[3])` participants (interquartile range: `r round(rep_dist[2])` - `r round(rep_dist[4])`), while original studies had a median of `r round(target_dist[3])` participants (interquartile range: `r round(target_dist[2])` - `r round(target_dist[4])`).].  In nearly all cases, replications were conducted online, with recruitment from Amazon Mechanical Turk (the default from 2011 to 2020) or Prolific (the default from 2021 -- 2022). 

Many different measures can be used to define replication success of an individual statistical result [@simonsohn2015; @gelman2018; @mathur2020].  However, whether a replication should be considered successful is not always dependent on only one statistical comparison between the two studies. Often in original papers, multiple statistical tests are cited in support of the claim that a pattern of results matches a particular theoretical expectation. 

As our primary outcome, we  chose to use a subjective replication score (coded by two independent raters -- one typically at the time of project completion -- with discrepancies resolved by discussion). Unlike statistical measures, subjective replication success accommodates studies with multiple important outcome measures that together define the pattern of interest. Further, this measure was applicable across the diverse range of statistical measures and reporting practices present in the sample. 
<!-- Importantly, a holistic measure of replication success had already been coded for most projects when they were turned in at the end of the class. For reliability, VB independently code the replication success from the students' written reports; discrepancies were resolved by discussion between MCF and VB (inter-rater reliability, Spearman's $\rho$: `r round(irr,2)`, disagreement in `r round(pluck(matching,2,1)/176*100)`% of cases).  -->

As a complement to our primary subjective outcome, we also used two statistical measures of replication on the subset of the data where they were computable for the key statistic of interest (`r pluck(pred_int_avail,1)` cases, see Figure \ref{fig:prisma}). We used *p-original*, the *p*-value on the null hypothesis that the original and replication statistics are from the same distribution, and *prediction interval*, a binary measure of whether the replication statistic fell within the prediction interval of the original statistic [@mathur2020]. The prediction interval depends on the level of evidence of the original study; if the effect was marginal, the prediction interval could overlap zero; thus, a replication might fall within the predictive interval, and be consistent with the original outcome, but not provide compelling evidence for the claimed effect. Conversely, large original effects with precise point estimates may have prediction intervals that do not overlap a smaller replication effect size, and thus would be inconsistent with the original outcome, even though researcher intuition might classify it as a success. Thus, these two statistical metrics each quantify the similarity between a key statistic in the original study and the replication, but they will not always match researcher intuitions on whether a study replicated.

```{r smd, out.height="25%", fig.width=6, fig.height=3, fig.pos="ht", fig.cap="Relationship between effect size of the original study, effect size of the replication study, and subjective replication success rating, for those studies where effect size was applicable (N=112)."}
d |> 
  filter(target_d_calc < 5, rep_d_calc < 5) |>
  ggplot(aes(x=target_d_calc, y=rep_d_calc))+
 
  geom_abline(slope=1, intercept=0, lty = 2)+
  geom_smooth(method = "lm") + 
   geom_point(aes(color=as.factor(sub_rep)), size=2.5) +
  geom_hline(yintercept = 0, lty = 2)+
  scale_color_viridis(discrete=T, direction = 1, 
                      name = "Subjective\nReplication\nSuccess\n")+
  labs(x="Original effect size", y="Replication effect size") + 
  theme(legend.position = "right")

```


## Overall replication rate 

```{r}
sub_rep_rate <- d |> summarize(m=mean(sub_rep)*100)

pred_int_rate <- d |> filter(include %in% c("stats", "pred_int"))|> summarize(m=mean(as.numeric(predInt))*100)
porig_rate <- d |>filter(include %in% c("stats", "pred_int"))|> summarize(m=median(p_orig))

d |> filter(include %in% c("stats", "pred_int"))|> filter(predInt) |> nrow() -> predIntcount
d |> filter(include %in% c("stats", "pred_int"))|> nrow() -> predInttotal


# sample size considerations



# ggplot(d, aes(x=target_N, y=replication_N, color=as.factor(sub_rep)))+geom_point()+coord_trans(x="log", y="log")+geom_abline(slope=1)+ scale_color_viridis(discrete=T, direction = 1, 
#                       name = "Subjective\nReplication\nSuccess\n")
# d |> mutate(bigger_orig=replication_N<.9*target_N,
#             bigger_rep=replication_N>1.1*target_N,
#             similar=!bigger_orig & !bigger_rep) |> 
#   group_by(bigger_orig, bigger_rep, similar) |> tally()


```

Across the 176 studies, the average subjective replication score was `r round(pluck(sub_rep_rate,1))`%, which we can interpret as an overall subjective replication rate. `r round(pluck(pred_int_rate,1))`% (`r predIntcount`/`r predInttotal`) of replications has outcomes with point-estimates within the prediction interval of the original outcome. The median *p*-original value on the original and replication point-estimates coming from the same distribution was `r round(pluck(porig_rate, 1),2)`, representing the median probability that a replication study's estimate would be at least as extreme as was actually observed, if in fact the replication and original were statistically consistent. 

Figure \ref{fig:smd} shows the relationship between original standardized effect size, replication effect size, and subjective replication score. Some studies replicated with similar size effects to the original, and others failed to replicate, with replication effect sizes near zero. On average, there was a diminution of effect sizes from original to replication. This pattern of results is consistent with the results of RP:P [@openscienceconsortium2015]. 



```{r }


tau_predIntcount <- d |> filter(include %in% c("stats")) |> filter(!is.na(predInt_from_d)) |> filter(predInt_with_tau) |> nrow()
tau_predInttotal <- d |> filter(include %in% c("stats")) |> filter(!is.na(predInt_from_d))  |> nrow()

tau_pct <- tau_predIntcount/tau_predInttotal*100


```

Some multi-site replication projects have found heterogeneity in effect sizes across replication sites [@ebersole2020; @klein2018; @olsson2020]. As a test of sensitivity to heterogeneity, we assumed that the level of heterogeneity in hypothetical multi-site replications of our sampled articles was the same as the average level heterogeneity found by @olsson2020 in prior multi-site replications in psychology ($\tau=.21$ in units of standardized mean difference). Under this assumption, `r round(tau_pct)`% (`r tau_predIntcount`/`r tau_predInttotal`) of replication effect sizes are distributionally consistent with the original effect size. However, more work on understanding heterogeneity is needed to understand what levels of heterogeneity to expect across different implementations of the same experiment, and how considerations of heterogeneity should impact interpretations of both novel results and replication results. 

<!-- [Is this the right place to talk about heterogeneity / what did we want to say?]  -->

```{r cor}

for_cor <- read_csv(here("data","for_model.csv")) |> filter(include %in% c("stats", "exp", "pred_int")) |>
  select(sub_rep, 
         pub_year, subfield, open_data, open_mat, stanford, change_platform, log_ratio_ss, is_within, single_vignette, log_sample, log_trials) |> mutate(social=ifelse(subfield=="social", 1,0),other_psych=ifelse(subfield=="other-psych",1,0), non_psych=ifelse(subfield=="non-psych", 1,0)) 

sub_cor <- function(var, stat = "estimate") {
  if (stat == "estimate") {
    cor.test(for_cor$sub_rep, pull(for_cor, {{var}}))$estimate
  } else {
    cor.test(for_cor$sub_rep, pull(for_cor, {{var}}))$p.value
  }
}



preds <- c("pub_year", "open_data",  "open_mat", "stanford", "change_platform", 
           "log_ratio_ss", "is_within", "single_vignette", "log_sample", 
           "log_trials", "social", "other_psych", "non_psych")

cors <- tibble(preds = preds) |>
  mutate(r = sapply(preds, function(x) sub_cor(x, stat = "estimate")),
         p = sapply(preds, function(x) sub_cor(x, stat = "p"))) |> 
  mutate(Predictors=factor(preds, levels=c("social", "other_psych", "non_psych", "is_within", "single_vignette", "change_platform", "open_data", "open_mat", "stanford", "pub_year", "log_trials", "log_sample", "log_ratio_ss"), labels=c("Social psychology (versus cognitive psych)", "Other psychology (versus cognitive psych)", "Non psychology (versus cogntive psych)", "Within participants design (versus between participants)", "Single vignette (versus multiple items/inductions per condition)", "Switch to online for replication (versus same modality for original and replication)", "Open data", "Open materials", "Stanford affiliation of original authors at time of replication", "Publication year", "Log number of  trials", "Log original sample size", "Log ratio between replication and original sample sizes"))) |> arrange(desc(r)) |> select(r, p, Predictors)

library(kableExtra)
knitr::kable(cors, digits = 3, align='ccl',format="latex", position="!h", caption="The correlation between each individual predictor and the subjective replication score. For subfield, cognitive psychology is treated as the baseline condition. See Methods for how these variables were coded.", booktabs=TRUE, linesep="") |> kable_styling(full_width=F, font_size=10) 

```

```{r, include=F}


 within <- glm(sub_rep ~ is_within, data=for_cor, family=binomial)$coefficient[2] |> exp() 
 vignette <- glm(sub_rep ~ single_vignette, data=for_cor, family=binomial)$coefficient[2] |> exp()
 
  subfield <- glm(sub_rep ~ subfield, data=for_cor |> filter(subfield %in% c("social", "cognitive")), family=binomial)$coefficient[2] |> exp()


```

```{r}

within <- for_cor |> group_by(is_within) |> summarize(avg=mean(sub_rep)*100)

cog <- for_cor |> group_by(subfield) |> summarize(avg=mean(sub_rep)*100)
vignette <- for_cor |> group_by(single_vignette) |> summarize(avg=mean(sub_rep)*100)

```

## Independent correlates of replication success

We investigated what features of the original study and replication were correlated with replication success, with the goal of being able to identify potential markers of replicability. We chose a set of predictor variables based on the correlational results of RP:P [@openscienceconsortium2015], our own intuitions of experimental design factors that might impact replication success, and some covariates related to how close the replication was; a full description of these features is given in the Methods. 

Many predictors individually correlated with subjective replication success (Table \ref{tab:cor}). Predictors of higher replicability included within-participants designs, larger numbers of trials per participant, and the original study having openly accessible data. Predictors of lower replicability included single-vignette studies (those with only one experimental stimulus per condition), classification as social psychology, and study pairs where the original study was in-person and the replication switched to online. 

Distributions of study outcomes across some of these properties are shown in Figure \ref{fig:predictors-graph}. Both social and cognitive psychology studies were well represented in the replication sample, and the cognitive psychology studies replicated more often than social psychology studies (`r pluck(cog,2,1) |> round()`% versus `r pluck(cog,2,4) |> round()`%). Within and between participants designs were both common, and within-participants designs replicated more often than between-participants designs (`r pluck(within,2,2) |> round()`% versus `r pluck(within,2,1) |> round()`%). Studies with multiple vignettes replicated more often than single vignetted studies (`r pluck(vignette,2,1) |> round()`% versus `r pluck(vignette,2,2) |> round()`%). However, there were strong correlations among these experimental features as well as between these experimental features and specific subfields. 

Studies with open data, which almost always also had open materials as well, tended to replicate more than studies without open data. Nearly all replication studies were conducted online, but original studies were split between using in-person and online recruitment. Replications that switched to online were less likely to replicate than those that had the same modality as the original (generally both online, in a few cases both in-person).  While online studies in general show comparable results to studies conducted in person [@crump2013], switching the modality does decrease the closeness of the replication, and some studies done in person may not have been well-adapted (e.g., inductions might have been weaker or instructions might have been insufficient). These factors -- open materials, open data, and online samples -- are more common in more recent studies, and so these effects may partially reflect temporal trends. 


```{r predictors-graph, out.width="100%", fig.width=8, fig.height=4, fig.pos="ht", fig.cap="Distribution of subjective replication scores within categories. Bar heights are counts of studies."}
dat <- read_csv(here("data","for_model.csv")) |> filter(include %in% c("stats", "exp", "pred_int")) |> mutate(sub_rep=as.factor(sub_rep))


sub_with_leg <- dat |> mutate(subfield=factor(subfield, levels=c("cognitive", "social", "other-psych", "non-psych"), 
                                              labels=c("Cognitive\npsychology", "Social\npsychology", "Other\npsychology", "Not\npsychology"))) |>
  count(subfield, sub_rep, .drop=F) |> 
  ggplot(aes(x=subfield, fill=sub_rep, y=n))+
  geom_bar(stat="identity", position="dodge")+
  scale_fill_viridis(discrete=T)+
    coord_cartesian(ylim=c(0,55), expand=F)+
  theme(axis.title.x=element_blank(), axis.title.y=element_blank())+
  labs(fill="Subjective\nreplication\nscore")

leg <- get_legend(sub_with_leg)

subfield <- sub_with_leg+theme(legend.position="none")

open <- dat |> mutate(openness=case_when(
  open_mat==1& open_data==1 ~ "Open materials \n Open data",
  open_mat==1 ~ "Open materials \n No open data",
  open_data==1 ~ "No open materials \n Open data",
  T ~ "No open materials \n No open data") |> factor()) |> 
    count(openness, sub_rep, .drop=F) |> 
  ggplot( aes(x=openness, y=n, fill=sub_rep))+
  geom_bar(stat="identity", position="dodge")+
  scale_fill_viridis(discrete=T)+
    coord_cartesian(ylim=c(0,55), expand=F)+
  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), legend.position="none")

modal <- dat |> mutate(platform=ifelse(change_platform,"Switch to online\n","Same modality\n")) |> count(platform, sub_rep, .drop=F) |>  ggplot(aes(x=platform, y=n, fill=sub_rep))+
  geom_bar(stat="identity", position="dodge")+
  scale_fill_viridis(discrete=T)+
    coord_cartesian(ylim=c(0,55), expand=F)+
  theme(axis.title.y=element_blank(), axis.title.x=element_blank(), legend.position="none")


within <- dat |> mutate(is_within=ifelse(is_within, "Within \nparticipants", "Between\nparticipants")) |> 
  count(is_within, sub_rep, .drop=F) |> ggplot(aes(x=is_within, y=n, fill=sub_rep))+
  geom_bar(stat="identity", position="dodge")+
  scale_fill_viridis(discrete=T)+
  coord_cartesian(ylim=c(0,55), expand=F)+
  theme(axis.title.y=element_blank(), axis.title.x=element_blank(), legend.position="none")


vignette <- dat |> mutate(single_vignette=ifelse(single_vignette, "Single \nvignette", "Multiple \nvignettes")) |> count(single_vignette, sub_rep, .drop=F) |> ggplot(aes(x=single_vignette,y=n, fill=sub_rep))+
  geom_bar(stat="identity", position="dodge")+
  scale_fill_viridis(discrete=T)+
    coord_cartesian(ylim=c(0,55), expand=F)+
  theme(axis.title.y=element_blank(), axis.title.x=element_blank(), legend.position="none")

top_row <- plot_grid(subfield, within, vignette, rel_widths=c(1, .6, .6), nrow=1)
mid_row <- plot_grid(open,  modal, leg, rel_widths=c(1.2, .6, .25), nrow=1)
plot_grid (top_row, mid_row, nrow=2)
```

```{r}
do_estimates <- function(model, variable){
  summary(model)$fixed |> as_tibble(rownames="var") |> filter(var==variable)|> mutate(text=str_c("$\\beta = ", round(Est.Error,2), ",  95\\% \\mathrm{CrI} = [", round(`l-95% CI`,2),", ", round(`u-95% CI`,2),"]$")) |> pull(text)
}

tier1_subjective <- read_rds(here(model_location, "tier1_subjective.rds"))

within_1 <- do_estimates(tier1_subjective, "is_within")

tier3_subjective <- read_rds(here(model_location, "tier3_subjective.rds"))

within_3 <- do_estimates(tier3_subjective, "is_within")

smd_3 <- do_estimates(tier3_subjective, "z_target_d_calc")

sens_3 <- read_rds(here(model_location, "sens_tier3_subjective.rds"))

within_sens <- do_estimates(sens_3, "is_within")


smd_sens <- do_estimates(sens_3, "z_target_d_calc")

pred_int <- read_rds(here(model_location, "tier3_predint.rds"))

within_2 <- do_estimates(pred_int, "is_within")

smd_2 <- do_estimates(pred_int, "z_target_d_calc")
```
 
## Joint evaluation of the predictors of replicability

While a number of features show individual correlations with the subjective replication score, many correlate with one another. To determine which predictors were the strongest, we ran a series of pre-registered Bayesian regression models using an ordinal link function and  regularized using a horseshoe shrinkage prior [@carvalho09]. We first ran models using all of the original-replication pairs (N=176), but without original effect size and original $p$ value as predictors, as they were uncodable for some pairs. We next ran models including all predictors, but on only the subset of data where all predictors were available (N=112). 

Coefficient estimates from the two ordinal models predicting the subjective replication scores are shown in Figure \ref{fig:mod-results}. Due to a large number of predictors coupled with a small and noisy dataset, there is much uncertainty around the coefficients even with strong regularization. The general directions of coefficients are consistent with the effects of the predictors in isolation. 

Within-participants designs stand out as the strongest correlate of replicability in the model with all the data (`r within_1`). In the model with all predictors, but less data, within-participants designs remain strong (`r within_3`), and standardized effect size is also substantially related to subjective replication score (`r smd_3`). Both effects are robust to a sensitivity analysis including only studies with close replications and matching statistical tests (within-participants `r within_sens`; effect size `r smd_sens`). 

We also ran models predicting our secondary outcome measures: a logistic model predicting whether the replication effect was within the prediction interval of the original effect, and a linear model predicting what the $p$-original was between the replication and original. Both these models had more uncertain estimates. While the credible intervals were wide, the general patterns of predictor direction and relative strength were similar to the subjective replication models (see Supplement for coefficients from all models). The strongest predictors for prediction interval were still within-participants designs (`r within_2`) and studies with larger effect sizes (`r smd_2`). 

```{r mod-results, out.width="90%", fig.width=8, fig.height=5, fig.pos="ht", fig.cap="Coefficients and uncertaintly estimates from a model of all original-replication pairs (N=176, shown in blue) and a model of all pairs with full statistical information (N=112, shown in red) and predicting subjective replication scores as the dependent variable. "}

do_draws <- function(model){
  draws <- model |> gather_draws(`b_[a-zA-Z_(): ]+`, regex=TRUE) |> 
    mutate(Term=str_sub(.variable, 3,-1) |> str_replace("M","_"), Estimate=.value) |>  filter(Term!="Intercept") |> 
    mutate(Term=factor(Term, levels=c("subfieldsocial", "subfieldother_psych", "subfieldnon_psych", "is_within", "single_vignette", "change_platform", "open_data", "open_mat", "stanford", "z_pub_year", "z_log_trials", "z_log_sample", "z_log_ratio_ss","z_log_p","z_target_d_calc"), labels=c("Social", "Other psych", "Non psych", "Within participants", "Single vignette", "Switch to online", "Open data", "Open materials", "Stanford", "Publication year", "Log n trials", "Log original sample size", "Log rep/orig sample", "P-value", "Original effect size"))) 
}

tier1_subjective <- read_rds(here(model_location, "tier1_subjective.rds")) |> do_draws() |> mutate(type="All pairs") |> mutate(sens="All data")
tier3_subjective <- read_rds(here(model_location, "tier3_subjective.rds"))|> do_draws() |> mutate(type="Pairs with full statistical information") |> mutate(sens="All data")

tier1_subjective |> union(tier3_subjective) |> ggplot(aes(y = reorder(Term, Estimate, mean), x = Estimate, color=type)) + geom_vline(xintercept=0)+
  scale_color_solarized()+
  stat_pointinterval(position=position_dodge(width=.7))+labs(y="", x="Estimate, 66%, 95% CrI predicting subjective replication score", color="", linetype="", shape="")+theme(axis.text=element_text(size=11),legend.position="none")

```

# Discussion

Non-replications pose a problem for scientists who want to build on the empirical results in the literature, but the limited numbers of replications and limited research into specific predictors of replication failure mean that the reasons for non-replications are not well understood. 

Here, we take a functional approach to assessing replicability, framing both our methods and interpretation around the idea of whether work can be repeated by an early-career scientist. We took advantage of 11 years of graduate student replication projects to study both the overall level of replication success and the correlational predictors of replication in a previously-unused dataset. In line with previous results, we found a `r round(pluck(sub_rep_rate,1))`% replication rate, with some studies showing effect sizes similar to the original and others much smaller. Within-participants designs, work in the subfield of cognitive psychology, and the original and replication both using online samples stood out as the strongest correlates of replication success. As many of these predictors interrelate with one another, we ran regularized regressions with all the predictors at once. Due to our small sample, model estimates were uncertain, but within-participants designs and large original effect sizes were the strongest predictors.

<!-- Large-scale replication studies including ours should be interpreted in light of their methods and their estimand. Given our sample, we are able to estimate the correlates of studies replicating when the replications are conducted online, by graduate students who have limited time and budget.  -->

We do not interpret our non-replications as indicating the original results were false positives: presumably some were and some were not. There are many possible reasons for the non-replications in this sample. In some cases, the problem may be with the replication, such as too few participants, many exclusions for failed attention checks, or participants speeding through the study. When these issues are diagnosed, they can suggest possible ways to "rescue" the replication by increasing the sample or changing the interface, without altering the underlying experiment; thus, while the replication did not succeed, after some troubleshooting, students may still be able to extend the work in the future. In other cases, there were a priori reasons to distrust the original study, such as exclusion criteria that seemed post-hoc or high-order interaction terms with a small sample. That said, not all scientists recognize the same factors as potential indications of low power or questionable research practices; students conducting these replications generally expected them to succeed. In many -- perhaps most -- non-replications in our sample, it was unclear why the results failed to replicate.

Our results are limited by the sample of studies we included, which are limited in number and may not be representative of the studies of interest to psychologists as a whole. Further, our predictor variables were not manipulated, so they cannot be interpreted as causing (non-)replication, but only as correlational markers. Some of the correlates are most easily interpreted as being about the original study, and others reflect the closeness of the replication to the original. For instance, while within-participants designs are more likely to replicate than between-participants designs, this predictor could also be related to the types of experiments that tend to be run in each design. Given the strong relationship of this factor to replicability, slightly more skepticism and critical reading of between-participants designs may be warranted, but this correlation, by itself, does not mean scientists should prefer within-participants designs. 

Large scale replication studies are costly and arduous. The batch of replications presented here were pedagogical replications, done as part of a class. Trainees must learn experimental methods, and conducting replications as part of methods classes serves several purposes: it enables students to learn to do experiments in a supportive context, it often leads to more useful results than if students designed their own experiments from scratch, and it creates a resource for studying the literature [@quintana2021; @wagge2019;@frank2012; @hawkins2018]. We believe that this kind of pedagogy has an important role to play in improving methodological practices in psychology more broadly. The tools and workflows of rigorous, replicable science cannot simply be mandated: they have to be learned.

# Methods
Our pre-registration, code, and coded data are available at TODO OSF REPO. 

## Dataset

```{r}
all <- read_csv(here("data", "raw_data.csv")) |> filter(include %in% c("stats", "pred_int", "exp")) 

ps <- all|> mutate(journal=str_to_lower(journal)) |>filter(journal=="psych sci")

```

The dataset of replication projects comes from class projects conducted in PSYCH 251 (earlier called PSYCH 254) a graduate-level experimental methods class taught at Stanford by MCF from 2011 to 2022. This class is commonly taken by first year graduate students in psychology and related disciplines, and it has been a requirement of the Psychology PhD since around 2015. Each student chose a study to replicate, implemented the study, wrote analysis code, pre-registered their replication, ran the study, and turned in a structured final report including methods, analytic plan, changes from the original study, confirmatory and exploratory analyses, and discussion of outcomes. Students were encouraged to do experimental replications, but some students chose to replicate correlational outcomes or do computational reproducibility projects instead. We cannot include the full student reports for confidentiality reasons, but we include some example reports we have permission to share and the template given to students at TOOD OSF REPO.

Students were free to choose what study to replicate; the recommended path for students who did not have their own ideas was to pick an interesting study from a recent year of Psychological Science (this led to a high fraction of Psych Science articles in the replication sample, `r nrow(ps)`, `r round( nrow(ps)/nrow(all)*100)`% of studies). 

Four of the replication projects were included in RP:P, and 10 were previously reported in @hawkins2018 (which reported 11 student replications from the 2015-2016 class, one of those was excluded from the current sample for being non-experimental).  

## Coding procedure

We relied primarily on student reports to code the measured variables for the replications. We supplemented this with spreadsheets of information about projects from the time of the class and the original papers.

### Measures of replication success
Our primary replication outcome was experimenter and instructor rated replication success. The subjective replication success was recorded by the teaching staff for the majority of class replications at the time they were conducted. Where the values were missing they were filled in by MCF on the basis of the reports. For all studies, replication success was independently coded by VB on the basis of the reports. Where VB’s coding disagreed with the staff/MCF’s code, the difference was resolved by discussion between VB and MCF (`r round(pluck(matching,2,1)/176*100)`% of studies). Subjective replication scores were coded on a [0, .25, .5, .75, 1] scale. 

This subjective replication outcome was chosen because it already existed, could be applied to all projects (regardless of type and detail of statistical reporting), and did not rely solely on one statistical measure. As a complement, we also identified a "key" statistical test for each paper (see below for details), and if possible, computed $p$-original and prediction interval at this statistic, following @mathur2020. $p$-original was a continuous measure of the $p$ value on the hypothesis that the original and replication samples come from the same distribution. Prediction interval was a binary measure of whether the replication outcome fell within the prediction interval of the original outcome measure. 

### Demographic properties
We coded the subfield of the original study as a 4 way factor: cognitive psychology, social psychology, other psychology, and non-psychology. For each paper, we coded its year of publication, whether it had open materials, whether it had open data, and whether it had been conducted using an online, crowd-sourced platform (i.e. MTurk or Prolific). 

### Experimental design properties
We coded experimental design on the basis of student reports, which often quoted from the original methods, and if that did not suffice, the original paper itself. To assess the role of repeated measures, we coded the number of trials seen per participant, including filler trials and trials in all conditions, but excluding training or practice trials. 

We coded whether the manipulation in the study was instantiated in a single instance (“single vignette”). Studies with one induction or prime used per condition across participants were coded as having a single vignette. Studies with multiple instances of the manipulation (even if each participant only saw one) were coded as not being single vignette. While most studies with a single vignette only had one trial and vice versa, there were studies with a single induction and multiple test trials, and other studies with multiple scenarios instantiating the manipulation, but only one shown per participant.  

We coded the number of participants, post-exclusions. We coded whether a study had a between-participants, within-participants, or mixed design; for the analysis, mixed studies were counted as within-participants designs. In the analysis, we used a log-scale for number of participants and numbers of trials. 

### Properties of replication
We coded whether the replication was conducted on a crowd-sourced platform; this was the norm for the class projects, but a few were done in-person. For analysis, we coded this into a variable indicating if the recruitment platform changed between original and replication. This grouped the few in-person replications in with the studies that were originally online and stayed online in a "no change" condition, in contrast with the studies that were originally in-person with online replications. 

We coded the replication sample size (after exclusions). This was transformed to the predictor variable log ratio of replication to original sample size. 

As a control variable, we included whether the original authors were faculty at Stanford at the time of the replication. This was to account for potential non-independence of these replications (ex. if replicating their advisor's work, students may have access to extra information about methods). 

We made note of studies to exclude for sensitivity analyses, due to not quite aligned statistics, extremely small or unbalanced sample sizes, or a student choosing a key statistical measure that was not of central importance to the original study. 

### Determination and coding of key statistical measure
For each study pair, we used one key measure of interest for which we calculated the predictor variables of $p$ value and effect size and the statistical outcome measures $p$-original and prediction interval. If the student specified a single key measure of interest and this was a measure that was reported in both the original paper and replication, we used that measure. If a student specified multiple, equally important, key measures, we used the first one. When students were not explicit about a key measure, we used other parts of their report (including introduction and power analysis) to determine what effect and therefore what result they considered key. In a few cases, we went back to the original paper to find what effect was considered crucial by the original authors. When the measures reported by the student did not cleanly match their explicit or implicitly stated key measure, we picked the most important (or first) of the measures that were reported in both the original and replication. These decisions could be somewhat subjective but importantly they were made without reference to replication outcomes. 

Whenever possible, we used per-condition means and standard deviations, or the test statistic of the key measure and its corresponding degrees of freedom (ex. T test, F test). We took the original statistic from the replication report if it quoted the relevant analysis or from the original paper if not. We took the replication statistics from the replication report. 

We then calculated $p$ values, effect sizes, $p$-original, and prediction intervals. We choose to recalculate p values and effect sizes from the means or test statistic rather than use reported measures when possible because we thought this would be more reliable and transparent. The means and test statistics are more likely to have been outputted programmatically and copied directly into the text. In contrast, $p$ values are often reported as <.001 rather than as a point value, and effect size derivations may be error prone. By recording the raw statistics we used and using our available code to calculate other measures, we are transparent, as the test statistics can be searched for in the papers, and all processing is documented in code. 

In some cases, $p$ values or effect sizes were not calculable either due to insufficient reporting (ex. reporting a $p$ value but no other statistics from a test) or key measures where $p$ values and effect sizes did not apply (ex. PCA as measure of interest). Where studies reported beta estimates and standard errors or proportions, standardized effects sizes are not an applicable measure, but we were still able to calculate $p$-original and prediction interval. 

We separately coded whether the original and replication effects were in the same direction, based on raw means and graphs. This is more reliable than the statistics because F-tests don't include the direction of effect, and some students may have flipped the direction in coding for betas or t-tests. In the processed data, the direction of the effect of the replication was always coded consistently with the original study’s coding, so a positive effect was in the same direction as the original and a negative effect in the opposite direction.  

In regression analyses, we used standardized mean difference and log $p$ value as predictors. 

## Modelling 

All original-replication pairs (except for one) had codable demographic and experimental features, while fewer pairs had codable effect sizes on some consistent scale, and fewer still had codable p-values and SMD effect sizes. Thus, we had more predictor variables and outcome variables for some original-replication pairs than for others, but which variables were codable was monotonic. To take full advantage of the data, we ran a series of models, with some models having fewer predictors, but more data, and others having more predictors, but less data. 

We ran a model predicting the subjective replication score on the basis of demographic and experimental predictors on the entire dataset. We ran two models predicting $p$-original and predicting whether the replication was in the prediction interval from demographic and experimental predictors on the subset of data where we had $p$-original and prediction intervals. Then, on the smaller subset of the data where we had effect sizes and $p$ values, we re-ran these three models with those as additional predictor variables. 

The subjective replication scores were coded on [0, .25, .5, .75, 1], and we ramapped these to 1-5 to run an ordinal regression predicting replication score. We ran logistic regressions predicting prediction interval and linear regressions predicting $p$-original. 

We used a horseshoe shrinkage prior on the fixed effect coefficients because we had a lot of predictors compared to the amount of data [@carvalho09]. All models included random slopes for predictors nested within year the class occurred to control for variation between cohorts of students. We did not include any interaction terms in the models. All numeric predictor variables were z-scored after other transforms (e.g., logs) to ensure comparable regularization effects from the horseshoe prior. The priors we used were horseshoe(3) for betas, normal(0,.5) for standard deviation of random slopes, and lkj(1) for correlations between random slopes. Models were run in BRMS [@brms].

As a secondary sensitivity analysis, we examined the subset of the data where the statistical tests had the same specification, the result was of primary importance in the original paper (i.e. not a manipulation check), and there were no big issues with the replication.

Results from these models not reported in the main paper are reported in the Supplement. 

# Acknowledgements {-}

TODO We are grateful to the students in PSYCH 254 and PSYCH 251 for conducting the replication projects included here. We thank Ben Prystawski and the FriSem audience for feedback on earlier versions of this work. TODO GRANTS??

# References {-}

<!-- Use this magic to place references here. -->
<div id="refs"></div>

